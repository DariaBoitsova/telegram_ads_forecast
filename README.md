# Telegram Ads Reach Forecasting

Проект посвящён прогнозированию охвата (VIEWS) рекламных объявлений в Telegram
на основе исторических данных.  
Решение представляет собой ML-модель регрессии и веб-сервис (REST API),
позволяющий оценить потенциальный охват объявления до его запуска.
## Постановка задачи

Цель проекта — разработать модель машинного обучения, которая прогнозирует
количество просмотров (VIEWS) рекламного объявления в Telegram
на основе следующих входных параметров:

- CPM — стоимость за 1000 показов
- CHANNEL_NAME — канал размещения
- DATE — дата размещения

Модель используется для оптимизации медиапланирования и распределения рекламных бюджетов.
## Данные

В проекте используется исторический датасет в формате CSV,
содержащий агрегированную статистику рекламных объявлений за два года.

Основные поля:
- CPM
- VIEWS (целевая переменная)
- CHANNEL_NAME
- DATE
- CLICKS, ACTIONS (использовались только для анализа)

Размер датасета: ~142 000 наблюдений.
## Исследовательский анализ данных (EDA)

В ходе анализа были выявлены следующие особенности:

- распределение VIEWS имеет выраженную правостороннюю асимметрию
- зависимость CPM → VIEWS носит нелинейный характер
- каналы существенно различаются по масштабу и стабильности охвата
- присутствует временная структура (дни недели, сезонность)

Это определило выбор модели и стратегию feature engineering.
## Feature Engineering

Для повышения качества модели были созданы следующие признаки:

- временные признаки: dayofweek, month, week, is_weekend
- нелинейные преобразования CPM (log, square)
- исторические агрегаты по каналам:
  - средний и медианный охват
  - количество исторических наблюдений
- нормализованный CPM относительно среднего CPM канала
- сглаживание агрегатов для снижения переобучения

Все агрегаты рассчитывались строго на исторических данных,
что исключает утечку информации (data leakage).
## Модель

В качестве основной модели был выбран CatBoostRegressor,
так как он эффективно работает с категориальными признаками
и выявляет сложные нелинейные зависимости.

Дополнительно была применена логарифмическая трансформация целевой переменной,
что позволило снизить влияние выбросов и улучшить качество прогноза.

Разделение данных на обучающую и тестовую выборки выполнено по времени (time-based split).
## Качество модели

Основная метрика качества — Mean Absolute Error (MAE).

Достигнутый результат:
- MAE ≈ 600–700 просмотров

По сравнению с baseline-моделью (линейная регрессия по CPM)
качество прогноза улучшено в несколько раз.

Модель демонстрирует стабильные результаты и не имеет систематического смещения.
## API

Реализован REST API с использованием FastAPI.

Endpoint:
POST /predict

Пример запроса:
{
  "cpm": 350,
  "channel": "tech_news",
  "date": "2024-11-15"
}

Пример ответа:
{
  "predicted_views": 12450
}
## Запуск проекта

1. Установить зависимости:
pip install -r requirements.txt

2. Запустить API:
uvicorn src.api:app --host 0.0.0.0 --port 8000

При первом запуске модель и статистика по каналам будут автоматически скачаны с Google Drive.
3. Отправить запрос на /predict
## Структура репозитория

telegram_ads_forecast/  
├── data/  
├── models/   # папка для хранения моделей; файлы скачиваются автоматически с Google Drive при старте API
├── src/  
│   ├── train.py  — скрипт для обучения модели. В репо он не сохраняет модели (CatBoost и stats) из-за большого размера файлов.
│   ├── features.py  
│   └── api.py  
├── requirements.txt  
├── .gitignore  
└── README.md  
